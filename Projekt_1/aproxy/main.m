clear all;

X = [ 20, 50, 100, 150, 200, 250, 280, 300 ];
XX= 20:.1:300;
Y = [ 0.46 , 0.64 , 0.78 , 0.68 , 0.44 , 0.23 , 0.18 , 0.18 ];

 

for i=1:length(XX)
    aWN(i)=WielomianNewtona(XX(i)) ;
    bSK(i)=FunkcjaSklejana(XX(i));
    van(i)=vandermond(XX(i));
    cAP3(i)=aproxFun3st(XX(i));
    dAP5(i)=aproxFun5st(XX(i));
    eFS3(i)=FunkcjaSklejana3Stopnia(XX(i));
end    

hold on;
plot( X,Y,"o" );
%plot( XX,aWN,"-" ); % a - interpolacja wielomianowa
%plot( XX,bSK,"-" ); % b - f.sklejana
%plot( XX,van,"-" ); % x - vandermond 7st.

%plot( XX,cAP3,"-" ); % c - aproksymacja 3 st.
%plot( XX,dAP5,"-" ); % d - aproksymacja 5 st.
%legend("techData","Interpolacja Wielomianowa Newton","sklejana","aprox fun 3 stop.","aprox fun 5 stop.")
plot( XX,eFS3,"-" ); % d - sklejane 3 st.
legend("techData","aproksymacja funkcjami 3 stopnia" )

% a
% interpolacja wielomianowa
% wielomian Newtona
%{
WN(x) = y0+f(x0,x1)(x-x0) + f(x0,x1,x2)(x-x0)(x-x1)+...

x  | y    |
20   0.46 *|  <- y0 <- index 1
50   0.64  | (.64-.46)/(50-20)=.006
100  0.78  | (.78-.64)/(100-50)=
150  0.68  |
200  0.44  |
250  0.23  |
280  0.18  |
300  0.18  |

20	0,460000						Newton	
50	0,640000	0,006000						
100	0,780000	0,002800	-0,000040					
150	0,680000	-0,002000	-0,000048	0,000000				
200	0,440000	-0,004800	-0,000028	0,000000	0,000000			
250	0,230000	-0,004200	0,000006	0,000000	0,000000	0,000000		
280	0,180000	-0,001667	0,000032	0,000000	0,000000	0,000000	0,000000	
300	0,180000	0,000000	0,000033	0,000000	0,000000	0,000000	0,000000	0,000000

y=0.46+06247*x+0.7594*x^2+0.6509*x^3+0.4118*x^4+0.2103*x^5+0.1650*x^6+0.1627*x^7

%}
function y=WielomianNewtona(x) %x0 => X(1)
    X = [ 20, 50, 100, 150, 200, 250, 280, 300 ];   %% local data 
    y= 0.46 + 0.006*(x-X(1))+-0.000040*(x-X(1))*(x-X(2))-0.00000006153846*(x-X(1))*(x-X(2))*(x-X(3))+0.00000000108262108262*(x-X(1))*(x-X(2))*(x-X(3))*(x-X(4))-0.0000000000026781*(x-X(1))*(x-X(2))*(x-X(3))*(x-X(4))*(x-X(5))-0.00000000000000021915*(x-X(1))*(x-X(2))*(x-X(3))*(x-X(4))*(x-X(5))*(x-X(6))-0.00000000000000003463*(x-X(1))*(x-X(2))*(x-X(3))*(x-X(4))*(x-X(5))*(x-X(6))*(x-X(7));
end


% funkcja sklejana
function y = FunkcjaSklejana(x)
    X = [ 20, 50, 100, 150, 200, 250, 280, 300   ];   %% local data + aprox data
    Y = [ 0.46 , 0.64 , 0.78 , 0.68 , 0.44 , 0.23 , 0.18 , 0.18  ];
    if (x>=X(1)) 
        if (x<=X(end))
        for i=1:length(X)-1
            if  ( x<=X( i+1 ))
                xx=x-X(i);
                H=(Y(i+1))-(Y(i)); 
                W=(X(i+1))-(X(i)); 
                y=Y(i)+(xx*H)/W; 
                return
            end % H/z proporcji H/y=W/x
        end    
        end
    end
end

%aproksymacja funkcjami 3 stopnia




function y = vandermond(x)

%prepare
if (false)
    X = [ 20, 50, 100, 150, 200, 250, 280, 300 ];
    Y = [ 0.46 , 0.64 , 0.78 , 0.68 , 0.44 , 0.23 , 0.18 , 0.18 ];
    n = length(Y);
    V = zeros(n);  
    for w=1:n
        for k=1:n
            V(w,k) = X(w)^(k-1);
        end    
    end  
    a=V \ Y';

    %{
A=0.337534516765287
0.00545792899408279
5.21966907736125e-05
-1.05465592811740e-06
5.75208196361954e-09
-1.78522463291645e-11
3.61385053692621e-14
-3.46263423186378e-17


0.337534516765287
0.005457928994083
0.000052196690774
-0.000001054655928
0.000000005752082
-0.000000000017852
0.000000000000036
0.000000000000000




    %}
end


%    y=0.337534516765287+0.00545792899408279*x+5.21966907736125e-05*x^2-1.05465592811740e-06*x^3+5.75208196361954e-09*x^4-1.78522463291645e-11*x^5+3.61385053692621e-14*x^6-3.46263423186378e-17*x^7;
% + schemat hornera
  
y=0.337534516765287+x*(0.00545792899408279+x*(5.21966907736125e-05+x*(-1.05465592811740e-06+x*(5.75208196361954e-09+x*(-1.78522463291645e-11+x*(3.61385053692621e-14+x*(-3.46263423186378e-17)))))));

end


function y = aproxFun3st(x)

    if ( false )
    X = [ 20, 50, 100, 150, 200, 250, 280, 300   ];   %% local data + aprox data
    Y = [ 0.46 , 0.64 , 0.78 , 0.68 , 0.44 , 0.23 , 0.18 , 0.18  ];    
    W = [ones(8,1) X' X'.^2];
    A =W'*W;
    b =W'*Y';
    a=A\b
    %{
a=
0.478524285255746
0.00343707585345168
-1.59263685413181e-05
    %}  
    end
    
    y=0.47852+x*0.003437+x*x*-0.000015926368;

end




function y = aproxFun5st(x)


    if ( false )
    X = [ 20, 50, 100, 150, 200, 250, 280, 300   ];   %% local data + aprox data
    Y = [ 0.46 , 0.64 , 0.78 , 0.68 , 0.44 , 0.23 , 0.18 , 0.18  ];
    W = [ones(8,1) X' X'.^2 X'.^3 X'.^4];
    A =W'*W;
    b =W'*Y';
    a=A\b
    %{
a=
0.270529360498919
0.0102965513204268
-5.28805197847902e-05
-2.89019332648018e-08
2.92192106012333e-10
    %}  
    end
    y=0.270529360498919+x*(0.0102965513204268+x*(-5.28805197847902e-05+x*(-2.89019332648018e-08+x*(2.92192106012333e-10))));    

end















% funkcja sklejana
function y = FunkcjaSklejana3Stopnia( x )
    X = [ 20, 50, 100, 150, 200, 250, 280, 300   ];   %% local data + aprox data
    %Y = [ 0.46 , 0.64 , 0.78 , 0.68 , 0.44 , 0.23 , 0.18 , 0.18  ];
    alp=.0; % alp = Y0 + alpha *h/3
    bet=.0; % alp = Yn+1 alpha *h/3
    Y = [ 0.46 , 0.64 , 0.78 , 0.68 , 0.44 , 0.23 , 0.18 , 0.18];    
    C=[ 7.12000000000000, 4.80000000000000, 4.44000000000000, 3.94000000000000, 2.67000000000000, 1.54000000000000, 2.13000000000000, 5.08000000000000 ];


    %x0  =X_(3);
    %xi  =X_(3+i);
    %xi_2=X_(3-2+i);
    %xi=X_(3+i);
    
    sum=0;
    for i=1:7
        yi=O(i,x);
        sum=sum+(yi*(C(i)));
    end
    y=sum;

    function y=O(i,x)
        X_ = [0 , 10 , 20 , 50 , 100 , 150 , 200, 250 , 280 , 300 , 320 , 340 ];
        ximinus2=X_(i);
        ximinus1=X_(i+1);
        xi      =X_(i+2);
        xiplus1 =X_(i+3);
        xiplus2 =X_(i+4);
        h=xi-xiplus1;
        h_=1/(h*h*h);

            if ( (x>ximinus2) && (x<=ximinus1)) y=h_*( (x-ximinus2)^3 ); 
        elseif ( (x>ximinus1) && (x<=xi))       y=h_*( (x-ximinus2)^3 -4*((x-ximinus1)^3)  ); 
        elseif ( (x>xi      ) && (x<=xiplus1))  y=h_*( (xiplus2-x)^3 -4*((xiplus1-x)^3)  ); 
        elseif ( (x>xiplus1 ) && (x<=xiplus2))  y=h_*( (xiplus2-x)^3 ); 
          else y=0;
           end
    end    

    return;

    % S(x) = ci-1*Oi-1(x) + ci*Oi(x) +ci+1*Oi+1(x) ... ci+1*Oi+1(x)

    % 4c0 + 2c1              = y0 + (h/3)*alpha
    %  c0 + 4c1 + c2         = y1
    %        c1 + 4c2 + c3   = y2


    A = [ 4, 2, 0, 0, 0, 0, 0, 0 
          1, 4, 1, 0, 0, 0, 0, 0
          0, 1, 4, 1, 0, 0, 0, 0
          0, 0, 1, 4, 1, 0, 0, 0
          0, 0, 0, 1, 4, 1, 0, 0
          0, 0, 0, 0, 1, 4, 1, 0        
          0, 0, 0, 0, 0, 1, 4, 1       
          0, 0, 0, 0, 0, 0, 2, 4 ];

    C=A*Y'

    %{
C0-Cn
    7.12000000000000
    4.80000000000000
    4.44000000000000
    3.94000000000000
    2.67000000000000
    1.54000000000000
    2.13000000000000
    5.08000000000000
    %} 

    
end